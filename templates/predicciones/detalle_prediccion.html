{% extends 'base.html' %}
{% load static %}

{% block title %}Detalle de Predicción{% endblock %}

{% block content %}
<div class="wrapper">
    <div class="details-header">
        <h2>Detalle de Predicción</h2>
        <div class="details-actions">
            <a href="{% url 'predicciones:tendencias_producto' producto.id %}" class="btn btn-primary">
                <i class="fas fa-chart-line"></i> Ver Tendencias
            </a>
            <a href="{% url 'predicciones:evaluar_prediccion' prediccion.id %}" class="btn btn-warning">
                <i class="fas fa-star"></i> Evaluar Predicción
            </a>
            <a href="{% url 'predicciones:lista_predicciones' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Volver
            </a>
        </div>
    </div>
    
    <div class="details-content">
        <div class="details-grid">
            <!-- Información del Producto -->
            <div class="details-section">
                <h3>Información del Producto</h3>
                <div class="details-item">
                    <h4>{{ producto.nombre }}</h4>
                    <p class="text-muted">{{ producto.descripcion }}</p>
                    
                    <div class="details-data">
                        <div class="details-row">
                            <div class="details-label">Categoría:</div>
                            <div class="details-value">{{ producto.categoria.nombre }}</div>
                        </div>
                        
                        <div class="details-row">
                            <div class="details-label">Precio:</div>
                            <div class="details-value">${{ producto.precio|floatformat:2 }}</div>
                        </div>
                        
                        <div class="details-row">
                            <div class="details-label">Stock Actual:</div>
                            <div class="details-value">{{ producto.cantidad_stock }} unidades</div>
                        </div>
                        
                        <div class="details-row">
                            <div class="details-label">Stock Mínimo:</div>
                            <div class="details-value">{{ producto.stock_minimo }} unidades</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Detalles de la Predicción -->
            <div class="details-section">
                <h3>Detalles de la Predicción</h3>
                
                <div class="stats-container">
                    <div class="stat-item">
                        <div class="stat-icon">
                            {% if prediccion.tipo_prediccion == 'venta' %}
                                <i class="fas fa-tags icon-primary"></i>
                            {% elif prediccion.tipo_prediccion == 'compra' %}
                                <i class="fas fa-shopping-cart icon-primary"></i>
                            {% elif prediccion.tipo_prediccion == 'precio' %}
                                <i class="fas fa-dollar-sign icon-primary"></i>
                            {% else %}
                                <i class="fas fa-boxes icon-primary"></i>
                            {% endif %}
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">Tipo de Predicción</div>
                            <div class="stat-value">
                                {% if prediccion.tipo_prediccion == 'venta' %}
                                    Oportunidad de Venta
                                {% elif prediccion.tipo_prediccion == 'compra' %}
                                    Oportunidad de Compra
                                {% elif prediccion.tipo_prediccion == 'precio' %}
                                    Ajuste de Precio
                                {% else %}
                                    Optimización de Stock
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon">
                            {% if prediccion.prioridad == 'alta' %}
                                <i class="fas fa-exclamation-circle icon-danger"></i>
                            {% elif prediccion.prioridad == 'media' %}
                                <i class="fas fa-exclamation icon-warning"></i>
                            {% else %}
                                <i class="fas fa-info-circle icon-success"></i>
                            {% endif %}
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">Prioridad</div>
                            <div class="stat-value">
                                {% if prediccion.prioridad == 'alta' %}
                                    <span class="text-danger">Alta</span>
                                {% elif prediccion.prioridad == 'media' %}
                                    <span class="text-warning">Media</span>
                                {% else %}
                                    <span class="text-success">Baja</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-alt icon-primary"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">Fecha de Generación</div>
                            <div class="stat-value">{{ prediccion.fecha_generacion|date:"d/m/Y H:i" }}</div>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon">
                            <i class="fas fa-sync-alt icon-primary"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">Rotación Mensual</div>
                            <div class="stat-value">{{ prediccion.rotacion_mensual|floatformat:2 }}</div>
                        </div>
                    </div>
                </div>
                
                <div class="details-item mt-4">
                    <h4>Recomendación</h4>
                    <div class="alert alert-info">
                        {{ prediccion.recomendacion }}
                    </div>
                    
                    <h4>Justificación</h4>
                    <p>{{ prediccion.justificacion }}</p>
                </div>
            </div>
        </div>
        
        <!-- Datos Adicionales -->
        <div class="details-section">
            <h3>Datos Adicionales</h3>
            
            <div class="table-wrapper">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Métrica</th>
                            <th>Valor</th>
                            <th>Tendencia</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Ventas Últimos 30 días</td>
                            <td>{{ prediccion.ventas_ultimos_30_dias }} unidades</td>
                            <td>
                                {% if prediccion.tendencia_ventas > 0 %}
                                    <span class="trend-indicator trend-up"><i class="fas fa-arrow-up"></i> {{ prediccion.tendencia_ventas|floatformat:1 }}%</span>
                                {% elif prediccion.tendencia_ventas < 0 %}
                                    <span class="trend-indicator trend-down"><i class="fas fa-arrow-down"></i> {{ prediccion.tendencia_ventas|floatformat:1 }}%</span>
                                {% else %}
                                    <span class="trend-indicator trend-stable"><i class="fas fa-equals"></i> 0%</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td>Margen Actual</td>
                            <td>{{ prediccion.margen_actual|floatformat:2 }}%</td>
                            <td>
                                {% if prediccion.tendencia_margen > 0 %}
                                    <span class="trend-indicator trend-up"><i class="fas fa-arrow-up"></i> {{ prediccion.tendencia_margen|floatformat:1 }}%</span>
                                {% elif prediccion.tendencia_margen < 0 %}
                                    <span class="trend-indicator trend-down"><i class="fas fa-arrow-down"></i> {{ prediccion.tendencia_margen|floatformat:1 }}%</span>
                                {% else %}
                                    <span class="trend-indicator trend-stable"><i class="fas fa-equals"></i> 0%</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td>Días de Stock Actual</td>
                            <td>{{ prediccion.dias_stock_actual }} días</td>
                            <td>
                                {% if prediccion.dias_stock_actual < 15 %}
                                    <span class="trend-indicator trend-down"><i class="fas fa-exclamation-triangle"></i> Bajo</span>
                                {% elif prediccion.dias_stock_actual > 60 %}
                                    <span class="trend-indicator trend-warning"><i class="fas fa-exclamation-triangle"></i> Alto</span>
                                {% else %}
                                    <span class="trend-indicator trend-stable"><i class="fas fa-check"></i> Óptimo</span>
                                {% endif %}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}